<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body>
  <div id="output">loading...</div>

  <script>
    // ===== CONFIG =====

    // Blocked usernames (case-sensitive)
    const blockedUsers = [
      // "baduser",
      // "test",
      // "admin"
    ];

    // ===== LOGIC =====

    const params = new URLSearchParams(window.location.search);
    const user = params.get("q");
    const output = document.getElementById("output");

    function showInvalid() {
      output.textContent = "invalid";
    }

    if (!user) {
      showInvalid();
      return;
    }

    if (user.length < 3 || user.length > 20) {
      showInvalid();
      return;
    }

    if (blockedUsers.includes(user)) {
      showInvalid();
      return;
    }

    // Deterministic hash → long key
    async function generateKey(input) {
      const encoder = new TextEncoder();
      const data = encoder.encode(input);

      const hash = await crypto.subtle.digest("SHA-512", data);
      const bytes = Array.from(new Uint8Array(hash));

      // Convert to hex
      let hex = bytes.map(b => b.toString(16).padStart(2, "0")).join("");

      // Stretch to 100–125 chars deterministically
      while (hex.length < 125) {
        hex += hex;
      }

      const length = 100 + (bytes[0] % 26); // 100–125
      return hex.slice(0, length);
    }

    generateKey(user).then(key => {
      output.textContent = key;
    });
  </script>
</body>
</html>
